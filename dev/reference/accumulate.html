<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="accumulate() sequentially applies a 2-argument function to elements of a
vector. Each application of the function uses the initial value or result
of the previous application as the first argument. The second argument is
the next value of the vector. The results of each application are
returned in a list. The accumulation can optionally terminate before
processing the whole vector in response to a done() signal returned by
the accumulation function.
By contrast to accumulate(), reduce() applies a 2-argument function in
the same way, but discards all results except that of the final function
application.
accumulate2() sequentially applies a function to elements of two lists, .x and .y."><title>Accumulate intermediate results of a vector reduction — accumulate • purrr</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.7/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.7/font.css" rel="stylesheet"><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Accumulate intermediate results of a vector reduction — accumulate"><meta property="og:description" content="accumulate() sequentially applies a 2-argument function to elements of a
vector. Each application of the function uses the initial value or result
of the previous application as the first argument. The second argument is
the next value of the vector. The results of each application are
returned in a list. The accumulation can optionally terminate before
processing the whole vector in response to a done() signal returned by
the accumulation function.
By contrast to accumulate(), reduce() applies a 2-argument function in
the same way, but discards all results except that of the final function
application.
accumulate2() sequentially applies a function to elements of two lists, .x and .y."><meta property="og:image" content="https://purrr.tidyverse.org/logo.png"><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="purrr.tidyverse.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">purrr</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.0.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/base.html">purrr &lt;-&gt; base R</a>
    <a class="dropdown-item" href="../articles/other-langs.html">Functional programming in other languages</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <h6 class="dropdown-header" data-toc-skip>Releases</h6>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2022/12/purrr-1-0-0/">Version 1.0.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/02/purrr-0-3-0/">Version 0.3.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2017/08/purrr-0.2.3/">Version 0.2.3</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tidyverse/purrr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Accumulate intermediate results of a vector reduction</h1>
      <small class="dont-index">Source: <a href="https://github.com/tidyverse/purrr/blob/HEAD/R/reduce.R" class="external-link"><code>R/reduce.R</code></a></small>
      <div class="d-none name"><code>accumulate.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>accumulate()</code> sequentially applies a 2-argument function to elements of a
vector. Each application of the function uses the initial value or result
of the previous application as the first argument. The second argument is
the next value of the vector. The results of each application are
returned in a list. The accumulation can optionally terminate before
processing the whole vector in response to a <code><a href="https://rlang.r-lib.org/reference/done.html" class="external-link">done()</a></code> signal returned by
the accumulation function.</p>
<p>By contrast to <code>accumulate()</code>, <code><a href="reduce.html">reduce()</a></code> applies a 2-argument function in
the same way, but discards all results except that of the final function
application.</p>
<p><code>accumulate2()</code> sequentially applies a function to elements of two lists, <code>.x</code> and <code>.y</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">accumulate</span><span class="op">(</span></span>
<span>  <span class="va">.x</span>,</span>
<span>  <span class="va">.f</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  <span class="va">.init</span>,</span>
<span>  .dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"forward"</span>, <span class="st">"backward"</span><span class="op">)</span>,</span>
<span>  .simplify <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  .ptype <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">accumulate2</span><span class="op">(</span><span class="va">.x</span>, <span class="va">.y</span>, <span class="va">.f</span>, <span class="va">...</span>, <span class="va">.init</span>, .simplify <span class="op">=</span> <span class="cn">NA</span>, .ptype <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>.x</dt>
<dd><p>A list or atomic vector.</p></dd>


<dt>.f</dt>
<dd><p>For <code>accumulate()</code> <code>.f</code> is 2-argument function. The function will
be passed the accumulated result or initial value as the first argument.
The next value in sequence is passed as the second argument.</p>
<p>For <code>accumulate2()</code>, a 3-argument function. The
function will be passed the accumulated result as the first
argument. The next value in sequence from <code>.x</code> is passed as the second argument. The
next value in sequence from <code>.y</code> is passed as the third argument.</p>
<p>The accumulation terminates early if <code>.f</code> returns a value wrapped in
a <code><a href="https://rlang.r-lib.org/reference/done.html" class="external-link">done()</a></code>.</p></dd>


<dt>...</dt>
<dd><p>Additional arguments passed on to the mapped function.</p>
<p>We now generally recommend against using <code>...</code> to pass additional
(constant) arguments to <code>.f</code>. Instead use a shorthand anonymous function:</p>
<p></p><div class="sourceCode R"><pre><code><span><span class="co"># Instead of</span></span>
<span><span class="va">x</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/map.html">map</a></span><span class="op">(</span><span class="va">f</span>, <span class="fl">1</span>, <span class="fl">2</span>, collapse <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span>
<span><span class="co"># do:</span></span>
<span><span class="va">x</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/map.html">map</a></span><span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">f</span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, <span class="fl">2</span>, collapse <span class="op">=</span> <span class="st">","</span><span class="op">)</span><span class="op">)</span></span></code></pre><p></p></div>
<p>This makes it easier to understand which arguments belong to which
function and will tend to yield better error messages.</p></dd>


<dt>.init</dt>
<dd><p>If supplied, will be used as the first value to start
the accumulation, rather than using <code>.x[[1]]</code>. This is useful if
you want to ensure that <code>reduce</code> returns a correct value when <code>.x</code>
is empty. If missing, and <code>.x</code> is empty, will throw an error.</p></dd>


<dt>.dir</dt>
<dd><p>The direction of accumulation as a string, one of
<code>"forward"</code> (the default) or <code>"backward"</code>. See the section about
direction below.</p></dd>


<dt>.simplify</dt>
<dd><p>If <code>NA</code>, the default, the accumulated list of
results is simplified to an atomic vector if possible.
If <code>TRUE</code>, the result is simplified, erroring if not possible.
If <code>FALSE</code>, the result is not simplified, always returning a list.</p></dd>


<dt>.ptype</dt>
<dd><p>If <code>simplify</code> is <code>NA</code> or <code>TRUE</code>, optionally supply a vector
prototype to enforce the output type.</p></dd>


<dt>.y</dt>
<dd><p>For <code>accumulate2()</code> <code>.y</code> is the second argument of the pair. It
needs to be 1 element shorter than the vector to be accumulated (<code>.x</code>).
If <code>.init</code> is set, <code>.y</code> needs to be one element shorted than the
concatenation of the initial value and <code>.x</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A vector the same length of <code>.x</code> with the same names as <code>.x</code>.</p>


<p>If <code>.init</code> is supplied, the length is extended by 1. If <code>.x</code> has
names, the initial value is given the name <code>".init"</code>, otherwise
the returned vector is kept unnamed.</p>


<p>If <code>.dir</code> is <code>"forward"</code> (the default), the first element is the
initial value (<code>.init</code> if supplied, or the first element of <code>.x</code>)
and the last element is the final reduced value. In case of a
right accumulation, this order is reversed.</p>


<p>The accumulation terminates early if <code>.f</code> returns a value wrapped
in a <code><a href="https://rlang.r-lib.org/reference/done.html" class="external-link">done()</a></code>. If the done box is empty, the last value is
used instead and the result is one element shorter (but always
includes the initial value, even when terminating at the first
iteration).</p>
    </div>
    <div class="section level2">
    <h2 id="life-cycle">Life cycle<a class="anchor" aria-label="anchor" href="#life-cycle"></a></h2>
    


<p><code><a href="reduce_right.html">accumulate_right()</a></code> is soft-deprecated in favour of the <code>.dir</code>
argument as of rlang 0.3.0. Note that the algorithm has
slightly changed: the accumulated value is passed to the right
rather than the left, which is consistent with a right reduction.</p>
    </div>
    <div class="section level2">
    <h2 id="direction">Direction<a class="anchor" aria-label="anchor" href="#direction"></a></h2>
    


<p>When <code>.f</code> is an associative operation like <code>+</code> or <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code>, the
direction of reduction does not matter. For instance, reducing the
vector <code>1:3</code> with the binary function <code>+</code> computes the sum <code>((1 + 2) + 3)</code> from the left, and the same sum <code>(1 + (2 + 3))</code> from the
right.</p>
<p>In other cases, the direction has important consequences on the
reduced value. For instance, reducing a vector with <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code> from
the left produces a left-leaning nested list (or tree), while
reducing <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code> from the right produces a right-leaning list.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="reduce.html">reduce()</a></code> when you only need the final reduced value.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># With an associative operation, the final value is always the</span></span></span>
<span class="r-in"><span><span class="co"># same, no matter the direction. You'll find it in the first element for a</span></span></span>
<span class="r-in"><span><span class="co"># backward (left) accumulation, and in the last element for forward</span></span></span>
<span class="r-in"><span><span class="co"># (right) one:</span></span></span>
<span class="r-in"><span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span> <span class="op">|&gt;</span> <span class="fu">accumulate</span><span class="op">(</span><span class="va">`+`</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  1  3  6 10 15</span>
<span class="r-in"><span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span> <span class="op">|&gt;</span> <span class="fu">accumulate</span><span class="op">(</span><span class="va">`+`</span>, .dir <span class="op">=</span> <span class="st">"backward"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 15 14 12  9  5</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The final value is always equal to the equivalent reduction:</span></span></span>
<span class="r-in"><span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span> <span class="op">|&gt;</span> <span class="fu"><a href="reduce.html">reduce</a></span><span class="op">(</span><span class="va">`+`</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 15</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># It is easier to understand the details of the reduction with</span></span></span>
<span class="r-in"><span><span class="co"># `paste()`.</span></span></span>
<span class="r-in"><span><span class="fu">accumulate</span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="va">paste</span>, sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "a"         "a.b"       "a.b.c"     "a.b.c.d"   "a.b.c.d.e"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Note how the intermediary reduced values are passed to the left</span></span></span>
<span class="r-in"><span><span class="co"># with a left reduction, and to the right otherwise:</span></span></span>
<span class="r-in"><span><span class="fu">accumulate</span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="va">paste</span>, sep <span class="op">=</span> <span class="st">"."</span>, .dir <span class="op">=</span> <span class="st">"backward"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "a.b.c.d.e" "b.c.d.e"   "c.d.e"     "d.e"       "e"        </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># By ignoring the input vector (nxt), you can turn output of one step into</span></span></span>
<span class="r-in"><span><span class="co"># the input for the next. This code takes 10 steps of a random walk:</span></span></span>
<span class="r-in"><span><span class="fu">accumulate</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, \<span class="op">(</span><span class="va">acc</span>, <span class="va">nxt</span><span class="op">)</span> <span class="va">acc</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, .init <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  0.0000000 -0.1939272 -0.3413195 -1.6211198 -3.8284090 -2.4850584</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7] -1.8804292 -1.5946893 -1.3272690 -1.1854501 -2.2403893</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># `accumulate2()` is a version of `accumulate()` that works with</span></span></span>
<span class="r-in"><span><span class="co"># 3-argument functions and one additional vector:</span></span></span>
<span class="r-in"><span><span class="va">paste2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">acc</span>, <span class="va">nxt</span>, <span class="va">sep</span> <span class="op">=</span> <span class="st">"."</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">acc</span>, <span class="va">nxt</span>, sep <span class="op">=</span> <span class="va">sep</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu">accumulate</span><span class="op">(</span><span class="va">paste2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "a"       "a.b"     "a.b.c"   "a.b.c.d"</span>
<span class="r-in"><span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu">accumulate2</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"-"</span>, <span class="st">"."</span>, <span class="st">"-"</span><span class="op">)</span>, <span class="va">paste2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "a"       "a-b"     "a-b.c"   "a-b.c-d"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># You can shortcircuit an accumulation and terminate it early by</span></span></span>
<span class="r-in"><span><span class="co"># returning a value wrapped in a done(). In the following example</span></span></span>
<span class="r-in"><span><span class="co"># we return early if the result-so-far, which is passed on the LHS,</span></span></span>
<span class="r-in"><span><span class="co"># meets a condition:</span></span></span>
<span class="r-in"><span><span class="va">paste3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">out</span>, <span class="va">input</span>, <span class="va">sep</span> <span class="op">=</span> <span class="st">"."</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">4</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rlang.r-lib.org/reference/done.html" class="external-link">done</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">out</span>, <span class="va">input</span>, sep <span class="op">=</span> <span class="va">sep</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">letters</span> <span class="op">|&gt;</span> <span class="fu">accumulate</span><span class="op">(</span><span class="va">paste3</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "a"     "a.b"   "a.b.c" "a.b.c"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Note how we get twice the same value in the accumulation. That's</span></span></span>
<span class="r-in"><span><span class="co"># because we have returned it twice. To prevent this, return an empty</span></span></span>
<span class="r-in"><span><span class="co"># done box to signal to accumulate() that it should terminate with the</span></span></span>
<span class="r-in"><span><span class="co"># value of the last iteration:</span></span></span>
<span class="r-in"><span><span class="va">paste3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">out</span>, <span class="va">input</span>, <span class="va">sep</span> <span class="op">=</span> <span class="st">"."</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">4</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rlang.r-lib.org/reference/done.html" class="external-link">done</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">out</span>, <span class="va">input</span>, sep <span class="op">=</span> <span class="va">sep</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">letters</span> <span class="op">|&gt;</span> <span class="fu">accumulate</span><span class="op">(</span><span class="va">paste3</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "a"     "a.b"   "a.b.c"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Here the early return branch checks the incoming inputs passed on</span></span></span>
<span class="r-in"><span><span class="co"># the RHS:</span></span></span>
<span class="r-in"><span><span class="va">paste4</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">out</span>, <span class="va">input</span>, <span class="va">sep</span> <span class="op">=</span> <span class="st">"."</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="va">input</span> <span class="op">==</span> <span class="st">"f"</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rlang.r-lib.org/reference/done.html" class="external-link">done</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">out</span>, <span class="va">input</span>, sep <span class="op">=</span> <span class="va">sep</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">letters</span> <span class="op">|&gt;</span> <span class="fu">accumulate</span><span class="op">(</span><span class="va">paste4</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "a"         "a.b"       "a.b.c"     "a.b.c.d"   "a.b.c.d.e"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simulating stochastic processes with drift</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="map.html">map</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, \<span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sim"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="map.html">map</a></span><span class="op">(</span>\<span class="op">(</span><span class="va">l</span><span class="op">)</span> <span class="fu">accumulate</span><span class="op">(</span><span class="va">l</span>, \<span class="op">(</span><span class="va">acc</span>, <span class="va">nxt</span><span class="op">)</span> <span class="fl">.05</span> <span class="op">+</span> <span class="va">acc</span> <span class="op">+</span> <span class="va">nxt</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="map.html">map</a></span><span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">x</span>, step <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="list_c.html">list_rbind</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"simulation"</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">step</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">simulation</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Simulations of a random walk with drift"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="http://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://github.com/lionel-" class="external-link">Lionel Henry</a>, <a href="https://www.rstudio.com" class="external-link"><img src="https://www.tidyverse.org/rstudio-logo.svg" alt="RStudio" width="72"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

  </div></footer></body></html>

